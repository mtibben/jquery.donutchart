(function(a){a.fn.donutchart=function(c,b){this.default_options={background_color:"#ccc",color:"red",size:160,donut_width:40,font_size:16,animate:true};this.options={};this.canvas=null;this.canvas_context=null;this.percentage_text_div=null;this.initDonutChart=function(){a(this).css({position:"relative",width:this.options.size+"px",height:this.options.size+"px"});this.canvas=a("<canvas></canvas>").attr({width:this.options.size,height:this.options.size,id:a(this).prop("id")+"_Canvas"});this.percentage_text_div=a("<div></div>").addClass("percentage_text").css({position:"absolute",top:"0px",left:"0px",width:this.options.size+"px",lineHeight:this.options.size+"px",textAlign:"center",fontFamily:"Arial,sans-serif",fontSize:this.options.font_size+"px",fontWeight:"bold"});a(this).append(this.canvas).append(this.percentage_text_div);if(typeof(G_vmlCanvasManager)!="undefined"){G_vmlCanvasManager.initElement(this.canvas.get(0))}this.canvas_context=this.canvas.get(0).getContext("2d");a(this).data("donut_chart_options",this.options);a(this).data("canvas",this.canvas);a(this).data("canvas_context",this.canvas_context);a(this).data("percentage_text_div",this.percentage_text_div);if(this.options.animate){this.animate(0)}else{this.fillToPercentage(parseInt(a(this).attr("data-percent")))}};this.drawBg=function(){var d=this.options.size/2;this.canvas_context.clearRect(0,0,this.options.size,this.options.size);this.canvas_context.beginPath();this.canvas_context.fillStyle=this.options.background_color;this.canvas_context.arc(d,d,d,0,2*Math.PI,false);this.canvas_context.arc(d,d,d-this.options.donut_width,0,2*Math.PI,true);this.canvas_context.fill()};this.drawFg=function(h){var f=this.options.size/2;var g=(h/100)*360;var e=Math.PI*(-90/180);var d=Math.PI*((-90+g)/180);this.canvas_context.beginPath();this.canvas_context.fillStyle=this.options.color;this.canvas_context.arc(f,f,f,e,d,false);this.canvas_context.arc(f,f,f-this.options.donut_width,d,e,true);this.canvas_context.fill()};this.animate=function(f){var d=parseInt(a(this).attr("data-percent"));var e=parseInt(a(this).attr("data-animation-iteration")!=null?a(this).attr("data-animation-iteration"):0);if(f!=null){if(isNaN(f)){throw"DonutChart widget: 'start_value' param is not a valid number"}e=parseInt(f)}this.fillToPercentage(e);if(e<d){a(this).attr("data-animation-iteration",++e);var g=a(this);setTimeout(function(){g.donutchart("animate")},20)}};this.fillToPercentage=function(d){this.drawBg();this.drawFg(d);this.percentage_text_div.text(d+"%")};if(typeof c=="string"){this.options=a(this).data("donut_chart_options");this.canvas=a(this).data("canvas");this.canvas_context=a(this).data("canvas_context");this.percentage_text_div=a(this).data("percentage_text_div");if(this.canvas==null){throw"DonutChart widget not initialized - cannot proceed"}switch(c){case"animate":if(b==null){this.animate()}else{if(isNaN(b)){throw"DonutChart widget: 'method_params' is not a valid number"}this.animate(b)}break;default:throw"DonutChart widget: invalid method called";break}}else{this.options=a.extend(this.default_options,c);this.initDonutChart()}return this}})(jQuery);